import{a as G}from"./chunk-N2JNDUIK.js";import{a as P,b as m,c as O,d as I,e as y,f as N,g as j,h as D,i as L,j as q,l as A,m as z}from"./chunk-TJG675SJ.js";import{b as S,c as T,e as F,n as C,p as M,s as B,w}from"./chunk-HFMNFIQ7.js";import{Da as x,Ia as c,R as h,Ua as d,Va as o,Wa as i,Xa as _,ca as g,cb as E,db as v,lb as a,ob as k,pb as b,sa as s,xa as p}from"./chunk-UFSGMEGV.js";import"./chunk-6MDQTQU3.js";function U(t,e){t&1&&(o(0,"span"),a(1,"El campo es requerido"),i())}function V(t,e){t&1&&(o(0,"span"),a(1,"M\xEDnimo 1 car\xE1cter"),i())}function X(t,e){t&1&&(o(0,"span"),a(1,"M\xE1ximo 20 caracteres"),i())}function $(t,e){if(t&1&&(o(0,"div",16),c(1,U,2,0,"span",17)(2,V,2,0,"span",17)(3,X,2,0,"span",17),i()),t&2){let r,n,l,u=v();s(),d("ngIf",(r=u.taskForm.get("title"))==null||r.errors==null?null:r.errors.required),s(),d("ngIf",(n=u.taskForm.get("title"))==null||n.errors==null?null:n.errors.minlength),s(),d("ngIf",(l=u.taskForm.get("title"))==null||l.errors==null?null:l.errors.maxlength)}}function H(t,e){t&1&&(o(0,"span"),a(1,"El campo es requerido"),i())}function J(t,e){t&1&&(o(0,"span"),a(1,"M\xEDnimo 1 car\xE1cter"),i())}function K(t,e){t&1&&(o(0,"span"),a(1,"M\xE1ximo 90 caracteres"),i())}function Q(t,e){if(t&1&&(o(0,"div",16),c(1,H,2,0,"span",17)(2,J,2,0,"span",17)(3,K,2,0,"span",17),i()),t&2){let r,n,l,u=v();s(),d("ngIf",(r=u.taskForm.get("description"))==null||r.errors==null?null:r.errors.required),s(),d("ngIf",(n=u.taskForm.get("description"))==null||n.errors==null?null:n.errors.minlength),s(),d("ngIf",(l=u.taskForm.get("description"))==null||l.errors==null?null:l.errors.maxlength)}}function W(t,e){if(t&1&&(o(0,"option",18),a(1),i()),t&2){let r=e.$implicit;d("value",b(r.id)),s(),k("",r.name," ",r.lastName)}}function Y(t,e){t&1&&(o(0,"span"),a(1,"El campo es requerido"),i())}function Z(t,e){if(t&1&&(o(0,"div",16),c(1,Y,2,0,"span",17),i()),t&2){let r,n=v();s(),d("ngIf",(r=n.taskForm.get("description"))==null||r.errors==null?null:r.errors.required)}}var R=class t{constructor(e,r,n,l,u){this.projectService=e;this.route=r;this.fb=n;this.authService=l;this.router=u;this.id=Number(this.route.snapshot.paramMap.get("id")),this.taskForm=this.fb.group({title:["",[m.required,m.minLength(1),m.maxLength(20)]],description:["",[m.required,m.minLength(1),m.maxLength(90)]],user_id:[null,m.required],project_id:[this.id,m.required],due_date:["",[m.required]]})}taskForm;task=g(null);id;userData;snackBar=h(B);users=g([]);isLoading=g(!1);error=g(null);ngOnInit(){this.loadUsers(),this.getProject()}getProject(){this.isLoading.set(!0),this.error.set(null),this.projectService.getTask(this.id).subscribe({next:e=>{this.task.set(e);let r=e.due_date?new Date(e.due_date).toISOString().slice(0,16):"";this.taskForm.patchValue({title:e.title,description:e.description,user_id:e.user_id,due_date:r,project_id:e.project_id}),this.isLoading.set(!1)},error:e=>{this.error.set("Error al cargar la tarea"),this.isLoading.set(!1),this.snackBar.open(`Error al recuperar la tarea: ${e}`,"X",{duration:3e3})}})}loadUsers(){this.isLoading.set(!0),this.error.set(null),this.authService.listUsers().subscribe({next:e=>{this.users.set(e),console.log(this.users()),this.isLoading.set(!1)},error:e=>{this.error.set("Error al cargar usuarios"),this.isLoading.set(!1),this.snackBar.open(`Error al cargar usuarios: ${e.message}`,"X",{duration:3e3})}})}onSubmit(){if(this.taskForm.invalid){this.taskForm.markAllAsTouched(),this.snackBar.open("Por favor complete el formulario correctamente","X",{duration:3e3});return}this.isLoading.set(!0),this.error.set(null),this.projectService.updateTask(this.id,this.taskForm.value).subscribe({next:e=>{this.snackBar.open("Tarea actualizada correctamente","X",{duration:3e3}),this.getProject()},error:e=>{this.error.set("Error al actualizar tarea"),this.snackBar.open(`Error al actualizar tarea: ${e.message}`,"X",{duration:3e3})},complete:()=>{this.isLoading.set(!1)}})}static \u0275fac=function(r){return new(r||t)(p(G),p(C),p(A),p(w),p(M))};static \u0275cmp=x({type:t,selectors:[["app-edit-task"]],decls:28,vars:5,consts:[[1,"contenedor-tareas"],[1,"formulario-tarea",3,"ngSubmit","formGroup"],[1,"titulo-formulario"],[1,"grupo-formulario"],["for","titulo"],["type","text","id","titulo","placeholder","Ingrese el t\xEDtulo","formControlName","title"],["class","error-message",4,"ngIf"],["for","descripcion"],["id","descripcion","rows","3","placeholder","Describa la tarea","formControlName","description"],["for","persona-encargada"],["id","persona-encargada","formControlName","user_id"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","fecha-finalizacion"],["type","datetime-local","id","fecha-hora","name","fecha-hora","formControlName","due_date"],["type","submit",1,"boton-primario"],[1,"error-message"],[4,"ngIf"],[3,"value"]],template:function(r,n){if(r&1&&(o(0,"div",0)(1,"form",1),E("ngSubmit",function(){return n.onSubmit()}),o(2,"h2",2),a(3,"Nueva Tarea"),i(),o(4,"div",3)(5,"label",4),a(6,"T\xEDtulo"),i(),_(7,"input",5),c(8,$,4,3,"div",6),i(),o(9,"div",3)(10,"label",7),a(11,"Descripci\xF3n"),i(),_(12,"textarea",8),c(13,Q,4,3,"div",6),i(),o(14,"div",3)(15,"label",9),a(16,"Persona encargada"),i(),o(17,"select",10)(18,"option",11),a(19,"Selecciona a una persona"),i(),c(20,W,2,4,"option",12),i()(),o(21,"div",3)(22,"label",13),a(23,"Fecha de Finalizaci\xF3n"),i(),_(24,"input",14),c(25,Z,2,1,"div",6),i(),o(26,"button",15),a(27,"Actualizar Tarea"),i()()()),r&2){let l,u,f;s(),d("formGroup",n.taskForm),s(7),d("ngIf",((l=n.taskForm.get("title"))==null?null:l.invalid)&&((l=n.taskForm.get("title"))==null?null:l.touched)),s(5),d("ngIf",((u=n.taskForm.get("description"))==null?null:u.invalid)&&((u=n.taskForm.get("title"))==null?null:u.touched)),s(7),d("ngForOf",n.users()),s(5),d("ngIf",((f=n.taskForm.get("description"))==null?null:f.invalid)&&((f=n.taskForm.get("title"))==null?null:f.touched))}},dependencies:[F,S,T,z,y,L,q,P,D,O,I,N,j],styles:[".contenedor-tareas[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.formulario-tarea[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:20px;border-radius:8px;margin-bottom:30px;box-shadow:0 2px 4px #0000001a}.titulo-formulario[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.grupo-formulario[_ngcontent-%COMP%]{margin-bottom:15px}.grupo-formulario[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:600;color:#444}.grupo-formulario[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.boton-primario[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px}.boton-primario[_ngcontent-%COMP%]:hover{background-color:#45a049}.error-message[_ngcontent-%COMP%]{color:#f44336;font-size:12px;margin-top:5px}input.ng-invalid.ng-touched[_ngcontent-%COMP%], textarea.ng-invalid.ng-touched[_ngcontent-%COMP%], select.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#f44336}"]})};export{R as EditTask};
