import{a as J}from"./chunk-7ZZ5QNJ3.js";import{a as D,b as p,c as L,d as w,e as B,f as V,g as q,h as z,i as $,j as A,l as G,m as R}from"./chunk-MSVUBPFR.js";import{b as P,c as I,e as y,n as N,p as j,s as U,w as X}from"./chunk-PJFXQNAB.js";import{$a as k,Da as T,Ia as u,R as S,Ua as c,Va as a,W as g,Wa as i,X as f,Xa as h,ca as x,cb as v,db as m,lb as s,mb as M,nb as E,ob as F,pb as O,sa as d,xa as _}from"./chunk-UFSGMEGV.js";import{a as b,b as C}from"./chunk-6MDQTQU3.js";function Q(r,t){r&1&&(a(0,"span"),s(1,"El campo es requerido"),i())}function W(r,t){r&1&&(a(0,"span"),s(1,"M\xEDnimo 1 car\xE1cter"),i())}function Y(r,t){r&1&&(a(0,"span"),s(1,"M\xE1ximo 20 caracteres"),i())}function Z(r,t){if(r&1&&(a(0,"div",18),u(1,Q,2,0,"span",19)(2,W,2,0,"span",19)(3,Y,2,0,"span",19),i()),r&2){let e,n,o,l=m(2);d(),c("ngIf",(e=l.taskForm.get("title"))==null||e.errors==null?null:e.errors.required),d(),c("ngIf",(n=l.taskForm.get("title"))==null||n.errors==null?null:n.errors.minlength),d(),c("ngIf",(o=l.taskForm.get("title"))==null||o.errors==null?null:o.errors.maxlength)}}function ee(r,t){r&1&&(a(0,"span"),s(1,"El campo es requerido"),i())}function te(r,t){r&1&&(a(0,"span"),s(1,"M\xEDnimo 1 car\xE1cter"),i())}function re(r,t){r&1&&(a(0,"span"),s(1,"M\xE1ximo 90 caracteres"),i())}function ie(r,t){if(r&1&&(a(0,"div",18),u(1,ee,2,0,"span",19)(2,te,2,0,"span",19)(3,re,2,0,"span",19),i()),r&2){let e,n,o,l=m(2);d(),c("ngIf",(e=l.taskForm.get("description"))==null||e.errors==null?null:e.errors.required),d(),c("ngIf",(n=l.taskForm.get("description"))==null||n.errors==null?null:n.errors.minlength),d(),c("ngIf",(o=l.taskForm.get("description"))==null||o.errors==null?null:o.errors.maxlength)}}function ne(r,t){if(r&1&&(a(0,"option",20),s(1),i()),r&2){let e=t.$implicit;c("value",O(e.id)),d(),F("",e.name," ",e.lastName)}}function ae(r,t){r&1&&(a(0,"span"),s(1,"El campo es requerido"),i())}function oe(r,t){if(r&1&&(a(0,"div",18),u(1,ae,2,0,"span",19),i()),r&2){let e,n=m(2);d(),c("ngIf",(e=n.taskForm.get("description"))==null||e.errors==null?null:e.errors.required)}}function se(r,t){if(r&1){let e=k();a(0,"form",3),v("ngSubmit",function(){g(e);let o=m();return f(o.onSubmit())}),a(1,"h2",4),s(2,"Nueva Tarea"),i(),a(3,"div",5)(4,"label",6),s(5,"T\xEDtulo"),i(),h(6,"input",7),u(7,Z,4,3,"div",8),i(),a(8,"div",5)(9,"label",9),s(10,"Descripci\xF3n"),i(),h(11,"textarea",10),u(12,ie,4,3,"div",8),i(),a(13,"div",5)(14,"label",11),s(15,"Persona encargada"),i(),a(16,"select",12)(17,"option",13),s(18,"Selecciona a una persona"),i(),u(19,ne,2,4,"option",14),i()(),a(20,"div",5)(21,"label",15),s(22,"Fecha de Finalizaci\xF3n"),i(),h(23,"input",16),u(24,oe,2,1,"div",8),i(),a(25,"button",17),s(26,"Guardar Tarea"),i()()}if(r&2){let e,n,o,l=m();c("formGroup",l.taskForm),d(7),c("ngIf",((e=l.taskForm.get("title"))==null?null:e.invalid)&&((e=l.taskForm.get("title"))==null?null:e.touched)),d(5),c("ngIf",((n=l.taskForm.get("description"))==null?null:n.invalid)&&((n=l.taskForm.get("title"))==null?null:n.touched)),d(7),c("ngForOf",l.users()),d(5),c("ngIf",((o=l.taskForm.get("description"))==null?null:o.invalid)&&((o=l.taskForm.get("title"))==null?null:o.touched))}}function le(r,t){if(r&1){let e=k();a(0,"div",35)(1,"button",36),v("click",function(){g(e);let o=m().$implicit,l=m(2);return f(l.editTask(o.id))}),s(2,"Editar"),i(),a(3,"button",37),v("click",function(){g(e);let o=m().$implicit,l=m(2);return f(l.delete(o.id))}),s(4,"Eliminar"),i()()}}function de(r,t){if(r&1){let e=k();a(0,"div",24)(1,"div",25)(2,"h3",26),s(3),i(),a(4,"span",27),s(5),i()(),a(6,"p",28),s(7),i(),a(8,"div",29)(9,"span"),s(10,"Estado:"),i(),a(11,"select",30),v("change",function(o){let l=g(e).$implicit,K=m(2);return f(K.editStatus(l.id,o.target.value))}),a(12,"option",31),s(13,"Pendiente"),i(),a(14,"option",32),s(15,"En progreso"),i(),a(16,"option",33),s(17,"Completada"),i()()(),u(18,le,5,0,"div",34),i()}if(r&2){let e=t.$implicit,n=m(2);d(3),M(e.title),d(2),E("Fecha: ",e.due_date),d(2),E("",e.description,"."),d(4),c("value",e.status),d(7),c("ngIf",n.userData.role=="admin")}}function ce(r,t){if(r&1&&(a(0,"div",21)(1,"h2",22),s(2,"Tareas Registradas"),i(),u(3,de,19,5,"div",23),i()),r&2){let e=m();d(3),c("ngForOf",e.tasks())}}var H=class r{constructor(t,e,n,o,l){this.projectService=t;this.route=e;this.fb=n;this.authService=o;this.router=l;this.id=Number(this.route.snapshot.paramMap.get("id")),this.taskForm=this.fb.group({title:["",[p.required,p.minLength(1),p.maxLength(20)]],description:["",[p.required,p.minLength(1),p.maxLength(90)]],user_id:[null,p.required],project_id:[this.id,p.required],due_date:["",[p.required]]})}taskForm;id;userData;snackBar=S(U);tasks=x(null);users=x([]);isLoading=x(!1);error=x(null);ngOnInit(){this.loadUser(),this.loadUsers(),this.load_task()}load_task(){this.isLoading.set(!1),this.error.set(null),this.projectService.getTasksByProject(this.id).subscribe({next:t=>{this.tasks.set(t),console.log(this.tasks()),this.isLoading.set(!1)},error:t=>{this.error.set(t),this.snackBar.open("Error al cargar tareas","X",{duration:3e3})}})}loadUsers(){this.isLoading.set(!0),this.error.set(null),this.authService.listUsers().subscribe({next:t=>{this.users.set(t),console.log(this.users()),this.isLoading.set(!1)},error:t=>{this.error.set("Error al cargar usuarios"),this.isLoading.set(!1),this.snackBar.open(`Error al cargar usuarios: ${t.message}`,"X",{duration:3e3})}})}onSubmit(){if(this.taskForm.valid){let t=C(b({},this.taskForm.value),{user_id:Number(this.taskForm.value.user_id),due_date:new Date(this.taskForm.value.due_date).toISOString()});this.isLoading.set(!0),this.projectService.createTask(t).subscribe({next:e=>{this.snackBar.open("Tarea creada","X",{duration:3e3}),this.load_task(),this.isLoading.set(!1),this.taskForm.reset({project_id:this.id})},error:e=>{this.error.set("Error al crear tarea"),this.isLoading.set(!1),this.snackBar.open(`Error al crear tarea: ${e.message}`,"X",{duration:3e3})}})}else console.log("Formulario inv\xE1lido. Errores:"),this.snackBar.open("Por favor complete todos los campos correctamente","X",{duration:3e3})}loadUser(){let t=localStorage.getItem("user");if(t)try{this.userData=JSON.parse(t)}catch{this.snackBar.open("Error al obtener datos del usuario","X",{duration:3e3}),this.userData=null}}delete(t){confirm("\xBFEst\xE1s seguro de eliminar la tarea?")&&(this.isLoading.set(!0),this.error.set(null),this.projectService.deleteTask(t).subscribe({next:()=>{this.snackBar.open("Tarea eliminada","X",{duration:3e3}),this.load_task()},error:e=>{this.error.set(`Error: ${e.message}`),this.snackBar.open("Error al eliminar Tarea","X",{duration:3e3})},complete:()=>{this.isLoading.set(!1)}}))}editTask(t){this.router.navigate(["/dashboard/edit_tasks",t])}editStatus(t,e){this.tasks()&&(this.isLoading.set(!0),console.log(`Actualizando tarea ${t} a estado: ${e}`),this.projectService.updateTaskStatus(t,e).subscribe({next:()=>{this.snackBar.open("Estado actualizado","Cerrar",{duration:3e3});let n=this.tasks().map(o=>o.id===t?C(b({},o),{status:e}):o);this.tasks.set(n)},error:n=>{console.error("Error en la respuesta:",{status:n.status,message:n.message,error:n.error});let o="Error al actualizar";n.status===400?o="Datos inv\xE1lidos enviados al servidor":n.status===401&&(o="No autorizado"),this.snackBar.open(`${o}`,"Cerrar",{duration:3e3}),this.load_task()},complete:()=>{this.isLoading.set(!1)}}))}static \u0275fac=function(e){return new(e||r)(_(J),_(N),_(G),_(X),_(j))};static \u0275cmp=T({type:r,selectors:[["app-tasks"]],decls:3,vars:2,consts:[[1,"contenedor-tareas"],["class","formulario-tarea",3,"formGroup","ngSubmit",4,"ngIf"],["class","listado-tareas",4,"ngIf"],[1,"formulario-tarea",3,"ngSubmit","formGroup"],[1,"titulo-formulario"],[1,"grupo-formulario"],["for","titulo"],["type","text","id","titulo","placeholder","Ingrese el t\xEDtulo","formControlName","title"],["class","error-message",4,"ngIf"],["for","descripcion"],["id","descripcion","rows","3","placeholder","Describa la tarea","formControlName","description"],["for","persona-encargada"],["id","persona-encargada","formControlName","user_id"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","fecha-finalizacion"],["type","datetime-local","id","fecha-hora","name","fecha-hora","formControlName","due_date"],["type","submit",1,"boton-primario"],[1,"error-message"],[4,"ngIf"],[3,"value"],[1,"listado-tareas"],[1,"titulo-listado"],["class","tarjeta-tarea",4,"ngFor","ngForOf"],[1,"tarjeta-tarea"],[1,"cabecera-tarjeta"],[1,"titulo-tarea"],[1,"fecha-tarea"],[1,"descripcion-tarea"],[1,"estado-tarea"],[1,"selector-estado",3,"change","value"],["value","pending"],["value","in_progress"],["value","completed"],["class","acciones-tarea",4,"ngIf"],[1,"acciones-tarea"],[1,"boton-editar",3,"click"],[1,"boton-eliminar",3,"click"]],template:function(e,n){e&1&&(a(0,"div",0),u(1,se,27,5,"form",1)(2,ce,4,1,"div",2),i()),e&2&&(d(),c("ngIf",n.userData.role=="admin"),d(),c("ngIf",n.tasks()&&!n.isLoading()))},dependencies:[y,P,I,R,B,$,A,D,z,L,w,V,q],styles:[".contenedor-tareas[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.formulario-tarea[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:20px;border-radius:8px;margin-bottom:30px;box-shadow:0 2px 4px #0000001a}.titulo-formulario[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.grupo-formulario[_ngcontent-%COMP%]{margin-bottom:15px}.grupo-formulario[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:600;color:#444}.grupo-formulario[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.boton-primario[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px}.boton-primario[_ngcontent-%COMP%]:hover{background-color:#45a049}.titulo-listado[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.tarjeta-tarea[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:15px;box-shadow:0 1px 3px #0000001a}.cabecera-tarjeta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.titulo-tarea[_ngcontent-%COMP%]{color:#2c3e50;margin:0}.fecha-tarea[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px}.descripcion-tarea[_ngcontent-%COMP%]{color:#34495e;margin-bottom:15px}.estado-tarea[_ngcontent-%COMP%]{margin-bottom:15px}.selector-estado[_ngcontent-%COMP%]{padding:5px;border-radius:4px;border:1px solid #ddd;margin-left:10px}.acciones-tarea[_ngcontent-%COMP%]{display:flex;gap:10px}.boton-editar[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:5px 10px;border:none;border-radius:4px;cursor:pointer}.boton-eliminar[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff;padding:5px 10px;border:none;border-radius:4px;cursor:pointer}.boton-editar[_ngcontent-%COMP%]:hover{background-color:#2980b9}.boton-eliminar[_ngcontent-%COMP%]:hover{background-color:#c0392b}.error-message[_ngcontent-%COMP%]{color:#f44336;font-size:12px;margin-top:5px}input.ng-invalid.ng-touched[_ngcontent-%COMP%], textarea.ng-invalid.ng-touched[_ngcontent-%COMP%], select.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#f44336}"]})};export{H as Tasks};
