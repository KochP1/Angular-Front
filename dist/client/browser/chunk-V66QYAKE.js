import{a as R}from"./chunk-N2JNDUIK.js";import{a as k,b as l,c as y,d as j,e as I,f as L,g as F,h as D,i as A,j as V,k as q,l as T,m as $}from"./chunk-TJG675SJ.js";import{b as O,c as w,e as U,p as N,s as B,w as G}from"./chunk-HFMNFIQ7.js";import{$a as P,Da as S,Ia as v,R as C,Ua as m,Va as r,W as x,Wa as e,X as _,Xa as b,ca as g,cb as h,db as u,lb as i,mb as c,nb as E,pb as M,sa as a,xa as f}from"./chunk-UFSGMEGV.js";import"./chunk-6MDQTQU3.js";function J(o,t){o&1&&(r(0,"div",24),i(1," Cargando usuarios... "),e())}function H(o,t){if(o&1&&(r(0,"div",25),i(1),e()),o&2){let n=u();a(),E(" ",n.error()," ")}}function K(o,t){if(o&1&&(r(0,"option",32),i(1),e()),o&2){let n=t.$implicit;m("value",M(n.id)),a(),c(n.name)}}function Q(o,t){if(o&1){let n=P();r(0,"tr")(1,"td"),i(2),e(),r(3,"td"),i(4),e(),r(5,"td"),i(6),e(),r(7,"td"),i(8),e(),r(9,"td"),i(10),e(),r(11,"td",26)(12,"button",27),h("click",function(){let d=x(n).$implicit,p=u();return _(p.editUser(d.id))}),i(13,"Editar"),e(),r(14,"button",28),h("click",function(){let d=x(n).$implicit,p=u();return _(p.deleteUser(d.id))}),i(15,"Eliminar"),e(),r(16,"select",29),h("change",function(d){let p=x(n).$implicit,X=u();return _(X.assignProject(p.id,d.target.value))}),r(17,"option",30),i(18,"Asigna un proyecto"),e(),v(19,K,2,3,"option",31),e()()()}if(o&2){let n=t.$implicit,s=u();a(2),c(n.id),a(2),c(n.name),a(2),c(n.lastName),a(2),c(n.email),a(2),c(n.role||"user"),a(9),m("ngForOf",s.projects())}}function W(o,t){o&1&&(r(0,"tr")(1,"td",33),i(2,"No hay usuarios registrados"),e()())}var z=class o{constructor(t,n,s,d){this.authService=t;this.fb=n;this.router=s;this.projectService=d;this.userForm=this.fb.group({name:["",[l.required,l.minLength(1),l.maxLength(50)]],lastName:["",[l.required,l.minLength(1),l.maxLength(50)]],email:["",[l.required,l.email]],password:["",[l.required,l.minLength(1),l.maxLength(12)]],role:["user",[l.required]]})}userForm;users=g([]);projects=g(null);isLoading=g(!1);error=g(null);userData;snackBar=C(B);newUser={name:"",lastName:"",email:"",password:"",role:"user"};ngOnInit(){this.loadUser(),this.loadUsers(),this.getProjects()}loadUser(){let t=localStorage.getItem("user");if(t)try{this.userData=JSON.parse(t)}catch{this.snackBar.open("Error al obtener datos del usuario","X",{duration:3e3}),this.userData=null}}loadUsers(){this.isLoading.set(!0),this.error.set(null),this.authService.listUsers().subscribe({next:t=>{this.users.set(t),this.isLoading.set(!1)},error:t=>{this.error.set("Error al cargar usuarios"),this.isLoading.set(!1),this.showError(`Error al cargar usuarios: ${t.message}`)}})}onSubmit(){this.userForm.valid&&(this.isLoading.set(!0),this.error.set(null),this.authService.register(this.userForm.value).subscribe({next:t=>{this.showSuccess("Usuario creado"),this.loadUsers()},error:t=>{this.showError(`Error al eliminar usuario: ${t.message}`),this.error.set(t.message||"Error durante el registro")},complete:()=>{this.isLoading.set(!1)}}))}editUser(t){this.router.navigate(["/dashboard/edit_users",t])}deleteUser(t){confirm("\xBFEst\xE1 seguro de eliminar este usuario?")&&(this.isLoading.set(!0),this.authService.deleteUser(t).subscribe({next:()=>{this.showSuccess("Usuario eliminado correctamente"),this.loadUsers()},error:n=>{this.showError(`Error al eliminar usuario: ${n.message}`),this.isLoading.set(!1)}}))}assignProject(t,n){this.isLoading.set(!0),this.projectService.assignProject(t,n).subscribe({next:()=>{this.showSuccess("Usuario asignado correctamente"),this.loadUsers()},error:s=>{this.showError(`Error al asignar usuario: ${s.message}`),this.isLoading.set(!1)}})}getProjects(){this.isLoading.set(!0),this.error.set(null),this.projectService.getAllProjects().subscribe({next:t=>{this.projects.set(t),console.log(this.projects()),this.isLoading.set(!1)},error:t=>{this.error.set("Error al cargar proyectos"),this.isLoading.set(!1),this.snackBar.open(`Error al recuperar proyectos: ${t}`,"X",{duration:3e3})}})}resetForm(){this.newUser={name:"",lastName:"",email:"",password:"",role:"user"}}showError(t){this.snackBar.open(t,"Cerrar",{duration:3e3,panelClass:["error-snackbar"]})}showSuccess(t){this.snackBar.open(t,"Cerrar",{duration:3e3,panelClass:["success-snackbar"]})}static \u0275fac=function(n){return new(n||o)(f(G),f(T),f(N),f(R))};static \u0275cmp=S({type:o,selectors:[["app-users"]],decls:57,vars:5,consts:[[1,"users-container"],[1,"user-form-container"],[1,"user-form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","name"],["type","text","id","name","name","name","required","","formControlName","name"],["for","lastName"],["type","text","id","lastName","name","lastName","required","","formControlName","lastName"],["for","email"],["type","email","id","email","name","email","required","","formControlName","email"],["for","password"],["type","password","id","password","name","password","required","","formControlName","password"],["for","role"],["id","role","name","role","formControlName","role"],["value","user"],["value","admin"],["type","submit",1,"btn-submit"],[1,"table-section"],["class","loading-spinner",4,"ngIf"],["class","error-message",4,"ngIf"],[1,"table-responsive"],[1,"users-table"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"loading-spinner"],[1,"error-message"],[1,"actions"],[1,"btn-edit",3,"click"],[1,"btn-delete",3,"click"],[3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["colspan","6",1,"text-center"]],template:function(n,s){if(n&1&&(r(0,"div",0)(1,"h2"),i(2,"Lista de Usuarios"),e(),r(3,"div",1)(4,"h3"),i(5,"Agregar Nuevo Usuario"),e(),r(6,"form",2),h("ngSubmit",function(){return s.onSubmit()}),r(7,"div",3)(8,"label",4),i(9,"Nombres"),e(),b(10,"input",5),e(),r(11,"div",3)(12,"label",6),i(13,"Apellidos"),e(),b(14,"input",7),e(),r(15,"div",3)(16,"label",8),i(17,"Email"),e(),b(18,"input",9),e(),r(19,"div",3)(20,"label",10),i(21,"Contrase\xF1a"),e(),b(22,"input",11),e(),r(23,"div",3)(24,"label",12),i(25,"Rol"),e(),r(26,"select",13)(27,"option",14),i(28,"Usuario"),e(),r(29,"option",15),i(30,"Administrador"),e()()(),r(31,"button",16),i(32,"Guardar Usuario"),e()()(),r(33,"div",17)(34,"h3"),i(35,"Lista de Usuarios"),e(),v(36,J,2,0,"div",18)(37,H,2,1,"div",19),r(38,"div",20)(39,"table",21)(40,"thead")(41,"tr")(42,"th"),i(43,"ID"),e(),r(44,"th"),i(45,"Nombres"),e(),r(46,"th"),i(47,"Apellidos"),e(),r(48,"th"),i(49,"Email"),e(),r(50,"th"),i(51,"Rol"),e(),r(52,"th"),i(53,"Acciones"),e()()(),r(54,"tbody"),v(55,Q,20,6,"tr",22)(56,W,3,0,"tr",23),e()()()()()),n&2){let d;a(6),m("formGroup",s.userForm),a(30),m("ngIf",s.isLoading()),a(),m("ngIf",s.error()),a(18),m("ngForOf",s.users()),a(),m("ngIf",((d=s.users())==null?null:d.length)===0&&!s.isLoading())}},dependencies:[U,O,w,$,I,A,V,k,D,y,j,q,L,F],styles:[".users-container[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.user-form-container[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:20px;border-radius:8px;box-shadow:0 0 10px #0000001a;margin-bottom:30px}.user-form-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;color:#343a40;border-bottom:1px solid #dee2e6;padding-bottom:10px}.user-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px}.form-group[_ngcontent-%COMP%]{margin-bottom:15px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:500;color:#495057}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px 12px;border:1px solid #ced4da;border-radius:4px;font-size:.9rem}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#80bdff;box-shadow:0 0 0 .2rem #007bff40}.btn-submit[_ngcontent-%COMP%]{grid-column:1 / -1;background-color:#28a745;color:#fff;border:none;padding:10px 15px;border-radius:4px;cursor:pointer;font-size:.9rem;transition:background-color .3s}.btn-submit[_ngcontent-%COMP%]:hover{background-color:#218838}@media (max-width: 768px){.user-form[_ngcontent-%COMP%]{grid-template-columns:1fr}}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto;box-shadow:0 0 10px #0000001a;border-radius:8px;margin-top:20px}.users-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:12px 15px;text-align:left;border-bottom:1px solid #ddd}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f8f9fa;font-weight:600;color:#495057}.users-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f1f1f1}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}.btn-edit[_ngcontent-%COMP%]{background-color:#17a2b8;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;transition:background-color .3s}.btn-edit[_ngcontent-%COMP%]:hover{background-color:#138496}.btn-delete[_ngcontent-%COMP%]{background-color:#dc3545;color:#fff;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;transition:background-color .3s}.btn-delete[_ngcontent-%COMP%]:hover{background-color:#c82333}@media (max-width: 768px){.users-table[_ngcontent-%COMP%]{font-size:.8rem}.users-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .users-table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:8px 10px}.actions[_ngcontent-%COMP%]{flex-direction:column;gap:4px}.btn-edit[_ngcontent-%COMP%], .btn-delete[_ngcontent-%COMP%]{padding:4px 8px;font-size:.7rem}}"]})};export{z as Users};
