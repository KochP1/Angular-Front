import{C as F,D as _,E as M,I as N,d as h,o as b,r as x,s as o,t as v,u as C,v as P,w as S,x as w}from"./chunk-QFEXWCDY.js";import{Da as f,R as g,Ua as d,Va as i,Wa as r,Xa as s,ca as m,cb as p,lb as n,sa as u,xa as l}from"./chunk-UFSGMEGV.js";import"./chunk-6MDQTQU3.js";var E=class c{constructor(t,e,a){this.fb=t;this.authService=e;this.router=a;this.settingsForm=this.fb.group({name:["",[o.required,o.minLength(1),o.maxLength(50)]],lastName:["",[o.required,o.minLength(1),o.maxLength(50)]],email:["",[o.required,o.email]]}),this.settingsPasswordForm=this.fb.group({currentPassword:["",[o.required,o.minLength(1),o.maxLength(12)]],newPassword:["",[o.required,o.minLength(1),o.maxLength(12)]]})}settingsForm;settingsPasswordForm;snackBar=g(M);userData;user=m(null);isLoading=m(!1);error=m(null);ngOnInit(){this.loadUser(),this.userData||this.router.navigate(["/"]),this.getUser(this.userData.id)}loadUser(){let t=localStorage.getItem("user");if(t)try{this.userData=JSON.parse(t)}catch{this.snackBar.open("Error al obtener datos del usuario","X",{duration:3e3}),this.userData=null}}getUser(t){this.isLoading.set(!0),this.error.set(null),this.authService.getUserById(t).subscribe({next:e=>{this.user.set(e),this.settingsForm.patchValue({name:this.user()?.name,lastName:this.user()?.lastName,email:this.user()?.email}),this.isLoading.set(!1)},error:e=>{this.error.set("Error obteniendo el usuario"),this.isLoading.set(!1),this.showError("Error obteniendo el usuario: "+e.message)}})}onSubmit(t){if(this.settingsForm.invalid){this.settingsForm.markAllAsTouched(),this.snackBar.open("Por favor complete el formulario correctamente","X",{duration:3e3});return}this.isLoading.set(!0),this.error.set(null),this.authService.updateUser(t,this.settingsForm.value).subscribe({next:e=>{this.snackBar.open("Usuario actualizado correctamente","X",{duration:3e3})},error:e=>{this.error.set("Error al actualizar usuario"),this.snackBar.open(`Error al actualizar usuario: ${e.message}`,"X",{duration:3e3})},complete:()=>{this.isLoading.set(!1)}})}changePassword(t){if(this.settingsPasswordForm.invalid){this.settingsPasswordForm.markAllAsTouched(),this.snackBar.open("Por favor complete el formulario correctamente","X",{duration:3e3});return}this.isLoading.set(!0),this.error.set(null),this.authService.updatePassword(t,this.settingsPasswordForm.value).subscribe({next:e=>{this.snackBar.open("Contras\xF1a actualizado correctamente","X",{duration:3e3}),this.authService.logout().subscribe()},error:e=>{this.error.set("Error al actualizar usuario"),this.snackBar.open(`Error al actualizar usuario: ${e.message}`,"X",{duration:3e3})},complete:()=>{this.isLoading.set(!1)}})}showError(t){this.snackBar.open(t,"Cerrar",{duration:3e3,panelClass:["error-snackbar"]})}showSuccess(t){this.snackBar.open(t,"Cerrar",{duration:3e3,panelClass:["success-snackbar"]})}static \u0275fac=function(e){return new(e||c)(l(F),l(N),l(b))};static \u0275cmp=f({type:c,selectors:[["app-settings"]],decls:31,vars:2,consts:[[1,"form-container"],[1,"user-form","personal-data-form",3,"ngSubmit","formGroup"],[1,"form-title"],[1,"form-group"],["for","name",1,"form-label"],["type","text","id","name","name","name","placeholder","Ingresa tus nombres","formControlName","name",1,"form-input"],["for","lastName",1,"form-label"],["type","text","id","lastName","name","lastName","placeholder","Ingresa tus apellidos","formControlName","lastName",1,"form-input"],["for","email",1,"form-label"],["type","email","id","email","name","email","placeholder","Ingresa tu email","formControlName","email",1,"form-input"],["type","submit",1,"submit-btn"],[1,"user-form","password-form",3,"ngSubmit","formGroup"],["for","newPassword",1,"form-label"],["type","password","placeholder","Ingresa tu contrase\xF1a actual","formControlName","currentPassword",1,"form-input"],["for","confirmPassword",1,"form-label"],["type","password","placeholder","Ingresa tu nueva contrase\xF1a","formControlName","newPassword",1,"form-input"]],template:function(e,a){e&1&&(i(0,"div",0)(1,"form",1),p("ngSubmit",function(){return a.onSubmit(a.userData.id)}),i(2,"h2",2),n(3,"Datos Personales"),r(),i(4,"div",3)(5,"label",4),n(6,"Nombres"),r(),s(7,"input",5),r(),i(8,"div",3)(9,"label",6),n(10,"Apellidos"),r(),s(11,"input",7),r(),i(12,"div",3)(13,"label",8),n(14,"Email"),r(),s(15,"input",9),r(),i(16,"button",10),n(17,"Actualizar Datos"),r()(),i(18,"form",11),p("ngSubmit",function(){return a.changePassword(a.userData.id)}),i(19,"h2",2),n(20,"Cambiar Contrase\xF1a"),r(),i(21,"div",3)(22,"label",12),n(23,"Contrase\xF1a Actual"),r(),s(24,"input",13),r(),i(25,"div",3)(26,"label",14),n(27,"Contrase\xF1a Nueva"),r(),s(28,"input",15),r(),i(29,"button",10),n(30,"Actualizar Datos"),r()()()),e&2&&(u(),d("formGroup",a.settingsForm),u(17),d("formGroup",a.settingsPasswordForm))},dependencies:[h,_,P,x,v,C,S,w],styles:[".form-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;display:flex;flex-direction:column;gap:40px}.user-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:25px;padding:30px;border-radius:12px;background-color:#fff;box-shadow:0 4px 12px #0000001a}.personal-data-form[_ngcontent-%COMP%]{border-top:5px solid #4a89dc}.password-form[_ngcontent-%COMP%]{border-top:5px solid #37bc9b}.form-title[_ngcontent-%COMP%]{margin:0 0 15px;font-size:1.8rem;color:#2c3e50;font-weight:600}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.form-label[_ngcontent-%COMP%]{font-size:1.2rem;color:#34495e;font-weight:500}.form-input[_ngcontent-%COMP%]{padding:14px 16px;font-size:1.1rem;border:2px solid #e0e6ed;border-radius:8px;transition:all .3s ease;background-color:#f8fafc}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#4a89dc;box-shadow:0 0 0 3px #4a89dc33}.form-input[_ngcontent-%COMP%]::placeholder{color:#b8c2cc;font-size:1rem}.submit-btn[_ngcontent-%COMP%]{align-self:flex-start;padding:14px 28px;font-size:1.1rem;background-color:#4a89dc;color:#fff;border:none;border-radius:8px;cursor:pointer;transition:background-color .3s;margin-top:10px}.submit-btn[_ngcontent-%COMP%]:hover{background-color:#3b7dd8}@media (max-width: 768px){.form-container[_ngcontent-%COMP%]{padding:15px;gap:30px}.user-form[_ngcontent-%COMP%]{padding:20px}.form-title[_ngcontent-%COMP%]{font-size:1.5rem}.form-label[_ngcontent-%COMP%]{font-size:1.1rem}.form-input[_ngcontent-%COMP%]{font-size:1rem;padding:12px 14px}.submit-btn[_ngcontent-%COMP%]{padding:12px 24px;font-size:1rem}}"]})};export{E as Settings};
