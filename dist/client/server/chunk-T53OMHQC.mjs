import './polyfills.server.mjs';
import{B as k,S as h,V as m,r as i,s as l}from"./chunk-KOCLY3DE.mjs";import{J as d,M as g,Q as u,k as n,u as a}from"./chunk-AKJV5UCE.mjs";var f=class p{constructor(o,e,t){this.http=o;this.router=e;this.authService=t}apiUrl=`${h.apiBaseUrl}/admin`;userApiUrl=`${h.apiBaseUrl}/user`;createProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t=new i({Authorization:`Bearer ${e}`});return this.http.post(`${this.apiUrl}/create_project`,o,{headers:t}).pipe(a(r=>(console.error("Error creating project:",r),n(()=>r))))}deleteProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t=new i({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}/delete_project/${o}`,{headers:t}).pipe(a(r=>(console.error("Error creating project:",r),n(()=>r))))}getProjects(){let o=this.authService.getToken(),e=this.authService.getUser();if(!o||!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let t=JSON.parse(e),r=new i({Authorization:`Bearer ${o}`});return this.http.get(`${this.apiUrl}/get_project/${t.id}`,{headers:r}).pipe(a(c=>(console.error("Error fetching projects:",c),n(()=>c))))}catch(t){return console.error("Error parsing user data:",t),n(()=>new Error("Datos de usuario corruptos"))}}getProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let t=new i({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/get_one_project/${o}`,{headers:t}).pipe(a(r=>(console.error("Error fetching projects:",r),n(()=>r))))}catch(t){return console.error("Error parsing user data:",t),n(()=>new Error("Datos de usuario corruptos"))}}updateProject(o,e){let t=this.authService.getToken(),r=new i({Authorization:`Bearer ${t}`});return this.http.put(`${this.apiUrl}/edit_project/${o}`,e,{headers:r})}getTasksByProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t=new i({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/get_task/${o}`,{headers:t}).pipe(a(r=>(console.error("Error fetching tasks:",r),n(()=>r))))}deleteTask(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t=new i({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}/delete_task/${o}`,{headers:t}).pipe(a(r=>(console.error("Error deleting the task:",r),n(()=>r))))}createTask(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t=new i({Authorization:`Bearer ${e}`});return this.http.post(`${this.apiUrl}/create_task`,o,{headers:t}).pipe(a(r=>(console.error("Error creating task:",r),n(()=>r))))}getTask(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let t=new i({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/get_task_id/${o}`,{headers:t}).pipe(a(r=>(console.error("Error fetching tasks:",r),n(()=>r))))}catch(t){return console.error("Error parsing user data:",t),n(()=>new Error("Datos de usuario corruptos"))}}updateTask(o,e){let t=this.authService.getToken(),r=new i({Authorization:`Bearer ${t}`});return this.http.put(`${this.apiUrl}/edit_task/${o}`,e,{headers:r})}updateTaskStatus(o,e){let t=this.authService.getToken();if(!t)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let r={Authorization:`Bearer ${t}`,"Content-Type":"application/json",Accept:"application/json"},c=JSON.stringify({status:e});return this.http.patch(`${this.userApiUrl}/update_task_progress/${o}`,c,{headers:new i(r),responseType:"json"}).pipe(d(s=>console.log("Respuesta del servidor:",s)),a(s=>(console.error("Error completo:",{status:s.status,url:s.url,headers:s.headers,error:s.error}),n(()=>s))))}static \u0275fac=function(e){return new(e||p)(u(l),u(k),u(m))};static \u0275prov=g({token:p,factory:p.\u0275fac,providedIn:"root"})};export{f as a};
