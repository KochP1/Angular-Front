import './polyfills.server.mjs';
import{a as H}from"./chunk-G5XIFZN4.mjs";import{B as D,E as L,F as p,G as w,H as B,I as q,J as V,K as A,L as G,M as R,N as U,P as X,Q as z,R as $,V as J,e as I,f as y,h as N,y as j}from"./chunk-KOCLY3DE.mjs";import{$a as i,Aa as g,Ga as F,La as m,R as M,W as h,X as b,Za as c,_a as n,ab as v,ca as _,eb as O,hb as x,ib as u,qb as o,rb as k,sb as E,tb as P,ub as S,va as s}from"./chunk-AKJV5UCE.mjs";import{a as C,b as T}from"./chunk-X2SEQXRR.mjs";function Q(t,r){t&1&&(n(0,"span"),o(1,"El campo es requerido"),i())}function W(t,r){t&1&&(n(0,"span"),o(1,"M\xEDnimo 1 car\xE1cter"),i())}function Y(t,r){t&1&&(n(0,"span"),o(1,"M\xE1ximo 20 caracteres"),i())}function Z(t,r){if(t&1&&(n(0,"div",17),m(1,Q,2,0,"span",18)(2,W,2,0,"span",18)(3,Y,2,0,"span",18),i()),t&2){let e,a,l,d=u();s(),c("ngIf",(e=d.taskForm.get("title"))==null||e.errors==null?null:e.errors.required),s(),c("ngIf",(a=d.taskForm.get("title"))==null||a.errors==null?null:a.errors.minlength),s(),c("ngIf",(l=d.taskForm.get("title"))==null||l.errors==null?null:l.errors.maxlength)}}function ee(t,r){t&1&&(n(0,"span"),o(1,"El campo es requerido"),i())}function te(t,r){t&1&&(n(0,"span"),o(1,"M\xEDnimo 1 car\xE1cter"),i())}function re(t,r){t&1&&(n(0,"span"),o(1,"M\xE1ximo 90 caracteres"),i())}function ie(t,r){if(t&1&&(n(0,"div",17),m(1,ee,2,0,"span",18)(2,te,2,0,"span",18)(3,re,2,0,"span",18),i()),t&2){let e,a,l,d=u();s(),c("ngIf",(e=d.taskForm.get("description"))==null||e.errors==null?null:e.errors.required),s(),c("ngIf",(a=d.taskForm.get("description"))==null||a.errors==null?null:a.errors.minlength),s(),c("ngIf",(l=d.taskForm.get("description"))==null||l.errors==null?null:l.errors.maxlength)}}function ne(t,r){if(t&1&&(n(0,"option",19),o(1),i()),t&2){let e=r.$implicit;c("value",S(e.id)),s(),P("",e.name," ",e.lastName)}}function ae(t,r){t&1&&(n(0,"span"),o(1,"El campo es requerido"),i())}function oe(t,r){if(t&1&&(n(0,"div",17),m(1,ae,2,0,"span",18),i()),t&2){let e,a=u();s(),c("ngIf",(e=a.taskForm.get("description"))==null||e.errors==null?null:e.errors.required)}}function se(t,r){if(t&1){let e=O();n(0,"div",23)(1,"div",24)(2,"h3",25),o(3),i(),n(4,"span",26),o(5),i()(),n(6,"p",27),o(7),i(),n(8,"div",28)(9,"span"),o(10,"Estado:"),i(),n(11,"select",29)(12,"option",19),o(13),i()()(),n(14,"div",30)(15,"button",31),x("click",function(){let l=h(e).$implicit,d=u(2);return b(d.editTask(l.id))}),o(16,"Editar"),i(),n(17,"button",32),x("click",function(){let l=h(e).$implicit,d=u(2);return b(d.delete(l.id))}),o(18,"Eliminar"),i()()()}if(t&2){let e=r.$implicit;s(3),k(e.title),s(2),E("Fecha: ",e.due_date),s(2),E("",e.description,"."),s(5),c("value",S(e.status)),s(),k(e.status)}}function le(t,r){if(t&1&&(n(0,"div",20)(1,"h2",21),o(2,"Tareas Registradas"),i(),m(3,se,19,6,"div",22),i()),t&2){let e=u();s(3),c("ngForOf",e.tasks())}}var K=class t{constructor(r,e,a,l,d){this.projectService=r;this.route=e;this.fb=a;this.authService=l;this.router=d;this.id=Number(this.route.snapshot.paramMap.get("id")),this.taskForm=this.fb.group({title:["",[p.required,p.minLength(1),p.maxLength(20)]],description:["",[p.required,p.minLength(1),p.maxLength(90)]],user_id:[null,p.required],project_id:[this.id,p.required],due_date:["",[p.required]]})}taskForm;id;userData;snackBar=M($);tasks=_(null);users=_([]);isLoading=_(!1);error=_(null);ngOnInit(){this.loadUser(),this.loadUsers(),this.load_task()}load_task(){this.isLoading.set(!1),this.error.set(null),this.projectService.getTasksByProject(this.id).subscribe({next:r=>{this.tasks.set(r),console.log(this.tasks()),this.isLoading.set(!1)},error:r=>{this.error.set(r),this.snackBar.open("Error al cargar tareas","X",{duration:3e3})}})}loadUsers(){this.isLoading.set(!0),this.error.set(null),this.authService.listUsers().subscribe({next:r=>{this.users.set(r),console.log(this.users()),this.isLoading.set(!1)},error:r=>{this.error.set("Error al cargar usuarios"),this.isLoading.set(!1),this.snackBar.open(`Error al cargar usuarios: ${r.message}`,"X",{duration:3e3})}})}onSubmit(){if(this.taskForm.valid){let r=T(C({},this.taskForm.value),{user_id:Number(this.taskForm.value.user_id),due_date:new Date(this.taskForm.value.due_date).toISOString()});this.isLoading.set(!0),this.projectService.createTask(r).subscribe({next:e=>{this.snackBar.open("Tarea creada","X",{duration:3e3}),this.load_task(),this.isLoading.set(!1),this.taskForm.reset({project_id:this.id})},error:e=>{this.error.set("Error al crear tarea"),this.isLoading.set(!1),this.snackBar.open(`Error al crear tarea: ${e.message}`,"X",{duration:3e3})}})}else console.log("Formulario inv\xE1lido. Errores:"),this.snackBar.open("Por favor complete todos los campos correctamente","X",{duration:3e3})}loadUser(){let r=localStorage.getItem("user");if(r)try{this.userData=JSON.parse(r)}catch{this.snackBar.open("Error al obtener datos del usuario","X",{duration:3e3}),this.userData=null}}delete(r){confirm("\xBFEst\xE1s seguro de eliminar la tarea?")&&(this.isLoading.set(!0),this.error.set(null),this.projectService.deleteTask(r).subscribe({next:()=>{this.snackBar.open("Tarea eliminada","X",{duration:3e3}),this.load_task()},error:e=>{this.error.set(`Error: ${e.message}`),this.snackBar.open("Error al eliminar Tarea","X",{duration:3e3})},complete:()=>{this.isLoading.set(!1)}}))}editTask(r){this.router.navigate(["/dashboard/edit_tasks",r])}static \u0275fac=function(e){return new(e||t)(g(H),g(j),g(X),g(J),g(D))};static \u0275cmp=F({type:t,selectors:[["app-tasks"]],decls:29,vars:6,consts:[[1,"contenedor-tareas"],[1,"formulario-tarea",3,"ngSubmit","formGroup"],[1,"titulo-formulario"],[1,"grupo-formulario"],["for","titulo"],["type","text","id","titulo","placeholder","Ingrese el t\xEDtulo","formControlName","title"],["class","error-message",4,"ngIf"],["for","descripcion"],["id","descripcion","rows","3","placeholder","Describa la tarea","formControlName","description"],["for","persona-encargada"],["id","persona-encargada","formControlName","user_id"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","fecha-finalizacion"],["type","datetime-local","id","fecha-hora","name","fecha-hora","formControlName","due_date"],["type","submit",1,"boton-primario"],["class","listado-tareas",4,"ngIf"],[1,"error-message"],[4,"ngIf"],[3,"value"],[1,"listado-tareas"],[1,"titulo-listado"],["class","tarjeta-tarea",4,"ngFor","ngForOf"],[1,"tarjeta-tarea"],[1,"cabecera-tarjeta"],[1,"titulo-tarea"],[1,"fecha-tarea"],[1,"descripcion-tarea"],[1,"estado-tarea"],[1,"selector-estado"],[1,"acciones-tarea"],[1,"boton-editar",3,"click"],[1,"boton-eliminar",3,"click"]],template:function(e,a){if(e&1&&(n(0,"div",0)(1,"form",1),x("ngSubmit",function(){return a.onSubmit()}),n(2,"h2",2),o(3,"Nueva Tarea"),i(),n(4,"div",3)(5,"label",4),o(6,"T\xEDtulo"),i(),v(7,"input",5),m(8,Z,4,3,"div",6),i(),n(9,"div",3)(10,"label",7),o(11,"Descripci\xF3n"),i(),v(12,"textarea",8),m(13,ie,4,3,"div",6),i(),n(14,"div",3)(15,"label",9),o(16,"Persona encargada"),i(),n(17,"select",10)(18,"option",11),o(19,"Selecciona a una persona"),i(),m(20,ne,2,4,"option",12),i()(),n(21,"div",3)(22,"label",13),o(23,"Fecha de Finalizaci\xF3n"),i(),v(24,"input",14),m(25,oe,2,1,"div",6),i(),n(26,"button",15),o(27,"Guardar Tarea"),i()(),m(28,le,4,1,"div",16),i()),e&2){let l,d,f;s(),c("formGroup",a.taskForm),s(7),c("ngIf",((l=a.taskForm.get("title"))==null?null:l.invalid)&&((l=a.taskForm.get("title"))==null?null:l.touched)),s(5),c("ngIf",((d=a.taskForm.get("description"))==null?null:d.invalid)&&((d=a.taskForm.get("title"))==null?null:d.touched)),s(7),c("ngForOf",a.users()),s(5),c("ngIf",((f=a.taskForm.get("description"))==null?null:f.invalid)&&((f=a.taskForm.get("title"))==null?null:f.touched)),s(3),c("ngIf",a.tasks()&&!a.isLoading())}},dependencies:[N,I,y,z,q,R,U,L,G,w,B,V,A],styles:[".contenedor-tareas[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.formulario-tarea[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:20px;border-radius:8px;margin-bottom:30px;box-shadow:0 2px 4px #0000001a}.titulo-formulario[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.grupo-formulario[_ngcontent-%COMP%]{margin-bottom:15px}.grupo-formulario[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:600;color:#444}.grupo-formulario[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.boton-primario[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px}.boton-primario[_ngcontent-%COMP%]:hover{background-color:#45a049}.titulo-listado[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.tarjeta-tarea[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:15px;box-shadow:0 1px 3px #0000001a}.cabecera-tarjeta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.titulo-tarea[_ngcontent-%COMP%]{color:#2c3e50;margin:0}.fecha-tarea[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px}.descripcion-tarea[_ngcontent-%COMP%]{color:#34495e;margin-bottom:15px}.estado-tarea[_ngcontent-%COMP%]{margin-bottom:15px}.selector-estado[_ngcontent-%COMP%]{padding:5px;border-radius:4px;border:1px solid #ddd;margin-left:10px}.acciones-tarea[_ngcontent-%COMP%]{display:flex;gap:10px}.boton-editar[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:5px 10px;border:none;border-radius:4px;cursor:pointer}.boton-eliminar[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff;padding:5px 10px;border:none;border-radius:4px;cursor:pointer}.boton-editar[_ngcontent-%COMP%]:hover{background-color:#2980b9}.boton-eliminar[_ngcontent-%COMP%]:hover{background-color:#c0392b}.error-message[_ngcontent-%COMP%]{color:#f44336;font-size:12px;margin-top:5px}input.ng-invalid.ng-touched[_ngcontent-%COMP%], textarea.ng-invalid.ng-touched[_ngcontent-%COMP%], select.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#f44336}"]})};export{K as Tasks};
