import './polyfills.server.mjs';
import{B as f,F as h,I as m,r as s,s as l}from"./chunk-BYPFPBGS.mjs";import{J as g,M as d,Q as u,k as n,u as a}from"./chunk-AKJV5UCE.mjs";var k=class p{constructor(o,e,r){this.http=o;this.router=e;this.authService=r}apiUrl=`${h.apiBaseUrl}/admin`;userApiUrl=`${h.apiBaseUrl}/user`;createProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let r=new s({Authorization:`Bearer ${e}`});return this.http.post(`${this.apiUrl}/create_project`,o,{headers:r}).pipe(a(t=>(console.error("Error creating project:",t),n(()=>t))))}deleteProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let r=new s({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}/delete_project/${o}`,{headers:r}).pipe(a(t=>(console.error("Error creating project:",t),n(()=>t))))}getProjects(){let o=this.authService.getToken(),e=this.authService.getUser();if(!o||!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let r=JSON.parse(e),t=new s({Authorization:`Bearer ${o}`});return this.http.get(`${this.apiUrl}/get_project/${r.id}`,{headers:t}).pipe(a(c=>(console.error("Error fetching projects:",c),n(()=>c))))}catch(r){return console.error("Error parsing user data:",r),n(()=>new Error("Datos de usuario corruptos"))}}getProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let r=new s({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/get_one_project/${o}`,{headers:r}).pipe(a(t=>(console.error("Error fetching projects:",t),n(()=>t))))}catch(r){return console.error("Error parsing user data:",r),n(()=>new Error("Datos de usuario corruptos"))}}getAllProjects(){let o=this.authService.getToken();if(!o)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let e=new s({Authorization:`Bearer ${o}`});return this.http.get(`${this.apiUrl}/get_all_projects/`,{headers:e}).pipe(a(r=>(console.error("Error fetching projects:",r),n(()=>r))))}catch(e){return console.error("Error parsing user data:",e),n(()=>new Error("Datos de usuario corruptos"))}}getAssignedProjects(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let r=new s({Authorization:`Bearer ${e}`});return this.http.get(`${this.userApiUrl}/user_projects/${o}/projects`,{headers:r}).pipe(a(t=>(console.error("Error fetching projects:",t),n(()=>t))))}catch(r){return console.error("Error parsing user data:",r),n(()=>new Error("Datos de usuario corruptos"))}}updateProject(o,e){let r=this.authService.getToken(),t=new s({Authorization:`Bearer ${r}`});return this.http.put(`${this.apiUrl}/edit_project/${o}`,e,{headers:t})}getTasksByProject(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let r=new s({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/get_task/${o}`,{headers:r}).pipe(a(t=>(console.error("Error fetching tasks:",t),n(()=>t))))}deleteTask(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let r=new s({Authorization:`Bearer ${e}`});return this.http.delete(`${this.apiUrl}/delete_task/${o}`,{headers:r}).pipe(a(t=>(console.error("Error deleting the task:",t),n(()=>t))))}createTask(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let r=new s({Authorization:`Bearer ${e}`});return this.http.post(`${this.apiUrl}/create_task`,o,{headers:r}).pipe(a(t=>(console.error("Error creating task:",t),n(()=>t))))}getTask(o){let e=this.authService.getToken();if(!e)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));try{let r=new s({Authorization:`Bearer ${e}`});return this.http.get(`${this.apiUrl}/get_task_id/${o}`,{headers:r}).pipe(a(t=>(console.error("Error fetching tasks:",t),n(()=>t))))}catch(r){return console.error("Error parsing user data:",r),n(()=>new Error("Datos de usuario corruptos"))}}updateTask(o,e){let r=this.authService.getToken(),t=new s({Authorization:`Bearer ${r}`});return this.http.put(`${this.apiUrl}/edit_task/${o}`,e,{headers:t})}updateTaskStatus(o,e){let r=this.authService.getToken();if(!r)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t={Authorization:`Bearer ${r}`,"Content-Type":"application/json",Accept:"application/json"},c=JSON.stringify({status:e});return this.http.patch(`${this.userApiUrl}/update_task_progress/${o}`,c,{headers:new s(t),responseType:"json"}).pipe(g(i=>console.log("Respuesta del servidor:",i)),a(i=>(console.error("Error completo:",{status:i.status,url:i.url,headers:i.headers,error:i.error}),n(()=>i))))}assignProject(o,e){let r=this.authService.getToken();if(console.log("Token a enviar:",r),!r)return this.router.navigate(["/"]),n(()=>new Error("No autenticado"));let t=new s({Authorization:`Bearer ${r.trim()}`,"Content-Type":"application/json"}),c=`${this.apiUrl}/assgin_project/${o}/${e}`;return console.log("URL completa:",c),this.http.post(c,{},{headers:t}).pipe(a(i=>(console.error("Error completo:",{status:i.status,message:i.message,error:i.error,url:i.url,headers:i.request?.headers}),n(()=>i))))}static \u0275fac=function(e){return new(e||p)(u(l),u(f),u(m))};static \u0275prov=d({token:p,factory:p.\u0275fac,providedIn:"root"})};export{k as a};
