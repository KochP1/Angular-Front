import './polyfills.server.mjs';
import{a as H}from"./chunk-T53OMHQC.mjs";import{B as D,E as L,F as m,G as B,H as w,I as V,J as q,K as z,L as $,M as A,N as G,P as R,Q as U,R as X,V as J,e as y,f as I,h as N,y as j}from"./chunk-KOCLY3DE.mjs";import{$a as r,Aa as _,Ga as T,La as u,R as C,W as x,X as h,Za as c,_a as a,ab as k,ca as f,eb as M,hb as v,ib as p,qb as s,rb as F,sb as S,tb as O,ub as P,va as l}from"./chunk-AKJV5UCE.mjs";import{a as b,b as E}from"./chunk-X2SEQXRR.mjs";function Q(i,t){i&1&&(a(0,"span"),s(1,"El campo es requerido"),r())}function W(i,t){i&1&&(a(0,"span"),s(1,"M\xEDnimo 1 car\xE1cter"),r())}function Y(i,t){i&1&&(a(0,"span"),s(1,"M\xE1ximo 20 caracteres"),r())}function Z(i,t){if(i&1&&(a(0,"div",17),u(1,Q,2,0,"span",18)(2,W,2,0,"span",18)(3,Y,2,0,"span",18),r()),i&2){let e,n,o,d=p();l(),c("ngIf",(e=d.taskForm.get("title"))==null||e.errors==null?null:e.errors.required),l(),c("ngIf",(n=d.taskForm.get("title"))==null||n.errors==null?null:n.errors.minlength),l(),c("ngIf",(o=d.taskForm.get("title"))==null||o.errors==null?null:o.errors.maxlength)}}function ee(i,t){i&1&&(a(0,"span"),s(1,"El campo es requerido"),r())}function te(i,t){i&1&&(a(0,"span"),s(1,"M\xEDnimo 1 car\xE1cter"),r())}function re(i,t){i&1&&(a(0,"span"),s(1,"M\xE1ximo 90 caracteres"),r())}function ie(i,t){if(i&1&&(a(0,"div",17),u(1,ee,2,0,"span",18)(2,te,2,0,"span",18)(3,re,2,0,"span",18),r()),i&2){let e,n,o,d=p();l(),c("ngIf",(e=d.taskForm.get("description"))==null||e.errors==null?null:e.errors.required),l(),c("ngIf",(n=d.taskForm.get("description"))==null||n.errors==null?null:n.errors.minlength),l(),c("ngIf",(o=d.taskForm.get("description"))==null||o.errors==null?null:o.errors.maxlength)}}function ne(i,t){if(i&1&&(a(0,"option",19),s(1),r()),i&2){let e=t.$implicit;c("value",P(e.id)),l(),O("",e.name," ",e.lastName)}}function ae(i,t){i&1&&(a(0,"span"),s(1,"El campo es requerido"),r())}function oe(i,t){if(i&1&&(a(0,"div",17),u(1,ae,2,0,"span",18),r()),i&2){let e,n=p();l(),c("ngIf",(e=n.taskForm.get("description"))==null||e.errors==null?null:e.errors.required)}}function se(i,t){if(i&1){let e=M();a(0,"div",23)(1,"div",24)(2,"h3",25),s(3),r(),a(4,"span",26),s(5),r()(),a(6,"p",27),s(7),r(),a(8,"div",28)(9,"span"),s(10,"Estado:"),r(),a(11,"select",29),v("change",function(o){let d=x(e).$implicit,g=p(2);return h(g.editStatus(d.id,o.target.value))}),a(12,"option",30),s(13,"Pendiente"),r(),a(14,"option",31),s(15,"En progreso"),r(),a(16,"option",32),s(17,"Completada"),r()()(),a(18,"div",33)(19,"button",34),v("click",function(){let o=x(e).$implicit,d=p(2);return h(d.editTask(o.id))}),s(20,"Editar"),r(),a(21,"button",35),v("click",function(){let o=x(e).$implicit,d=p(2);return h(d.delete(o.id))}),s(22,"Eliminar"),r()()()}if(i&2){let e=t.$implicit;l(3),F(e.title),l(2),S("Fecha: ",e.due_date),l(2),S("",e.description,"."),l(4),c("value",e.status)}}function le(i,t){if(i&1&&(a(0,"div",20)(1,"h2",21),s(2,"Tareas Registradas"),r(),u(3,se,23,4,"div",22),r()),i&2){let e=p();l(3),c("ngForOf",e.tasks())}}var K=class i{constructor(t,e,n,o,d){this.projectService=t;this.route=e;this.fb=n;this.authService=o;this.router=d;this.id=Number(this.route.snapshot.paramMap.get("id")),this.taskForm=this.fb.group({title:["",[m.required,m.minLength(1),m.maxLength(20)]],description:["",[m.required,m.minLength(1),m.maxLength(90)]],user_id:[null,m.required],project_id:[this.id,m.required],due_date:["",[m.required]]})}taskForm;id;userData;snackBar=C(X);tasks=f(null);users=f([]);isLoading=f(!1);error=f(null);ngOnInit(){this.loadUser(),this.loadUsers(),this.load_task()}load_task(){this.isLoading.set(!1),this.error.set(null),this.projectService.getTasksByProject(this.id).subscribe({next:t=>{this.tasks.set(t),console.log(this.tasks()),this.isLoading.set(!1)},error:t=>{this.error.set(t),this.snackBar.open("Error al cargar tareas","X",{duration:3e3})}})}loadUsers(){this.isLoading.set(!0),this.error.set(null),this.authService.listUsers().subscribe({next:t=>{this.users.set(t),console.log(this.users()),this.isLoading.set(!1)},error:t=>{this.error.set("Error al cargar usuarios"),this.isLoading.set(!1),this.snackBar.open(`Error al cargar usuarios: ${t.message}`,"X",{duration:3e3})}})}onSubmit(){if(this.taskForm.valid){let t=E(b({},this.taskForm.value),{user_id:Number(this.taskForm.value.user_id),due_date:new Date(this.taskForm.value.due_date).toISOString()});this.isLoading.set(!0),this.projectService.createTask(t).subscribe({next:e=>{this.snackBar.open("Tarea creada","X",{duration:3e3}),this.load_task(),this.isLoading.set(!1),this.taskForm.reset({project_id:this.id})},error:e=>{this.error.set("Error al crear tarea"),this.isLoading.set(!1),this.snackBar.open(`Error al crear tarea: ${e.message}`,"X",{duration:3e3})}})}else console.log("Formulario inv\xE1lido. Errores:"),this.snackBar.open("Por favor complete todos los campos correctamente","X",{duration:3e3})}loadUser(){let t=localStorage.getItem("user");if(t)try{this.userData=JSON.parse(t)}catch{this.snackBar.open("Error al obtener datos del usuario","X",{duration:3e3}),this.userData=null}}delete(t){confirm("\xBFEst\xE1s seguro de eliminar la tarea?")&&(this.isLoading.set(!0),this.error.set(null),this.projectService.deleteTask(t).subscribe({next:()=>{this.snackBar.open("Tarea eliminada","X",{duration:3e3}),this.load_task()},error:e=>{this.error.set(`Error: ${e.message}`),this.snackBar.open("Error al eliminar Tarea","X",{duration:3e3})},complete:()=>{this.isLoading.set(!1)}}))}editTask(t){this.router.navigate(["/dashboard/edit_tasks",t])}editStatus(t,e){this.tasks()&&(this.isLoading.set(!0),console.log(`Actualizando tarea ${t} a estado: ${e}`),this.projectService.updateTaskStatus(t,e).subscribe({next:()=>{this.snackBar.open("\u2705 Estado actualizado","Cerrar",{duration:3e3});let n=this.tasks().map(o=>o.id===t?E(b({},o),{status:e}):o);this.tasks.set(n)},error:n=>{console.error("Error en la respuesta:",{status:n.status,message:n.message,error:n.error});let o="Error al actualizar";n.status===400?o="Datos inv\xE1lidos enviados al servidor":n.status===401&&(o="No autorizado"),this.snackBar.open(`\u274C ${o}`,"Cerrar",{duration:3e3}),this.load_task()},complete:()=>{this.isLoading.set(!1)}}))}static \u0275fac=function(e){return new(e||i)(_(H),_(j),_(R),_(J),_(D))};static \u0275cmp=T({type:i,selectors:[["app-tasks"]],decls:29,vars:6,consts:[[1,"contenedor-tareas"],[1,"formulario-tarea",3,"ngSubmit","formGroup"],[1,"titulo-formulario"],[1,"grupo-formulario"],["for","titulo"],["type","text","id","titulo","placeholder","Ingrese el t\xEDtulo","formControlName","title"],["class","error-message",4,"ngIf"],["for","descripcion"],["id","descripcion","rows","3","placeholder","Describa la tarea","formControlName","description"],["for","persona-encargada"],["id","persona-encargada","formControlName","user_id"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","fecha-finalizacion"],["type","datetime-local","id","fecha-hora","name","fecha-hora","formControlName","due_date"],["type","submit",1,"boton-primario"],["class","listado-tareas",4,"ngIf"],[1,"error-message"],[4,"ngIf"],[3,"value"],[1,"listado-tareas"],[1,"titulo-listado"],["class","tarjeta-tarea",4,"ngFor","ngForOf"],[1,"tarjeta-tarea"],[1,"cabecera-tarjeta"],[1,"titulo-tarea"],[1,"fecha-tarea"],[1,"descripcion-tarea"],[1,"estado-tarea"],[1,"selector-estado",3,"change","value"],["value","pending"],["value","in_progress"],["value","completed"],[1,"acciones-tarea"],[1,"boton-editar",3,"click"],[1,"boton-eliminar",3,"click"]],template:function(e,n){if(e&1&&(a(0,"div",0)(1,"form",1),v("ngSubmit",function(){return n.onSubmit()}),a(2,"h2",2),s(3,"Nueva Tarea"),r(),a(4,"div",3)(5,"label",4),s(6,"T\xEDtulo"),r(),k(7,"input",5),u(8,Z,4,3,"div",6),r(),a(9,"div",3)(10,"label",7),s(11,"Descripci\xF3n"),r(),k(12,"textarea",8),u(13,ie,4,3,"div",6),r(),a(14,"div",3)(15,"label",9),s(16,"Persona encargada"),r(),a(17,"select",10)(18,"option",11),s(19,"Selecciona a una persona"),r(),u(20,ne,2,4,"option",12),r()(),a(21,"div",3)(22,"label",13),s(23,"Fecha de Finalizaci\xF3n"),r(),k(24,"input",14),u(25,oe,2,1,"div",6),r(),a(26,"button",15),s(27,"Guardar Tarea"),r()(),u(28,le,4,1,"div",16),r()),e&2){let o,d,g;l(),c("formGroup",n.taskForm),l(7),c("ngIf",((o=n.taskForm.get("title"))==null?null:o.invalid)&&((o=n.taskForm.get("title"))==null?null:o.touched)),l(5),c("ngIf",((d=n.taskForm.get("description"))==null?null:d.invalid)&&((d=n.taskForm.get("title"))==null?null:d.touched)),l(7),c("ngForOf",n.users()),l(5),c("ngIf",((g=n.taskForm.get("description"))==null?null:g.invalid)&&((g=n.taskForm.get("title"))==null?null:g.touched)),l(3),c("ngIf",n.tasks()&&!n.isLoading())}},dependencies:[N,y,I,U,V,A,G,L,$,B,w,q,z],styles:[".contenedor-tareas[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:20px;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.formulario-tarea[_ngcontent-%COMP%]{background-color:#f5f5f5;padding:20px;border-radius:8px;margin-bottom:30px;box-shadow:0 2px 4px #0000001a}.titulo-formulario[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.grupo-formulario[_ngcontent-%COMP%]{margin-bottom:15px}.grupo-formulario[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:5px;font-weight:600;color:#444}.grupo-formulario[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%], .grupo-formulario[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;font-size:14px}.grupo-formulario[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{resize:vertical}.boton-primario[_ngcontent-%COMP%]{background-color:#4caf50;color:#fff;padding:10px 15px;border:none;border-radius:4px;cursor:pointer;font-size:16px}.boton-primario[_ngcontent-%COMP%]:hover{background-color:#45a049}.titulo-listado[_ngcontent-%COMP%]{color:#333;margin-bottom:20px}.tarjeta-tarea[_ngcontent-%COMP%]{background-color:#fff;border:1px solid #ddd;border-radius:8px;padding:15px;margin-bottom:15px;box-shadow:0 1px 3px #0000001a}.cabecera-tarjeta[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.titulo-tarea[_ngcontent-%COMP%]{color:#2c3e50;margin:0}.fecha-tarea[_ngcontent-%COMP%]{color:#7f8c8d;font-size:14px}.descripcion-tarea[_ngcontent-%COMP%]{color:#34495e;margin-bottom:15px}.estado-tarea[_ngcontent-%COMP%]{margin-bottom:15px}.selector-estado[_ngcontent-%COMP%]{padding:5px;border-radius:4px;border:1px solid #ddd;margin-left:10px}.acciones-tarea[_ngcontent-%COMP%]{display:flex;gap:10px}.boton-editar[_ngcontent-%COMP%]{background-color:#3498db;color:#fff;padding:5px 10px;border:none;border-radius:4px;cursor:pointer}.boton-eliminar[_ngcontent-%COMP%]{background-color:#e74c3c;color:#fff;padding:5px 10px;border:none;border-radius:4px;cursor:pointer}.boton-editar[_ngcontent-%COMP%]:hover{background-color:#2980b9}.boton-eliminar[_ngcontent-%COMP%]:hover{background-color:#c0392b}.error-message[_ngcontent-%COMP%]{color:#f44336;font-size:12px;margin-top:5px}input.ng-invalid.ng-touched[_ngcontent-%COMP%], textarea.ng-invalid.ng-touched[_ngcontent-%COMP%], select.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#f44336}"]})};export{K as Tasks};
